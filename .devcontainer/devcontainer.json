{
  "name": "Ubuntu Dev Container",
  "image": "ubuntu:24.04",
  // Run commands after container is created
  "onCreateCommand": "chmod +x ./.devcontainer/setup.sh && ./.devcontainer/setup.sh",
  // Forward ports if needed
  "forwardPorts": [
    8080,
    3000,
    5000
  ],
  // Bind your workspace into the container
  "mounts": [
    "source=${localWorkspaceFolder},target=/workspace,type=bind",
  "source=${localEnv:XAUTHORITY},target=/root/.Xauthority,type=bind"
  ],
  "runArgs": [
    "--device=nvidia.com/gpu=all",
     "--device=/dev/dri",

  // display for X apps (fallback)
  "--env=DISPLAY=${localEnv:DISPLAY}",
  "--volume=/tmp/.X11-unix:/tmp/.X11-unix:rw",

  // wayland support
  "--env=WAYLAND_DISPLAY=${localEnv:WAYLAND_DISPLAY}",
  "--env=XDG_RUNTIME_DIR=/run/user/${localEnv:UID}",
  "--volume=/run/user/${localEnv:UID}:/run/user/${localEnv:UID}",

  // required on NixOS to avoid SELinux DAC failures
  "--security-opt=label=disable"
  ],
   "containerEnv": {
    "NVIDIA_VISIBLE_DEVICES": "all",
    "NVIDIA_DRIVER_CAPABILITIES": "all"
  },
  "remoteUser": "root",
  // Optional: VSCode features support
  "features": {
    "ghcr.io/devcontainers/features/docker-outside-of-docker:1": {},
    "ghcr.io/msclock/features/vcpkg:2": {
      "vcpkgDirectory": "/opt/vcpkg",
      "vcpkgRoot": "/opt/vcpkg"
    },
    "ghcr.io/schlich/devcontainer-features/starship:0": {}
  },
  "customizations": {
    "vscode": {
      "extensions": [
        "ms-vscode.cpptools-extension-pack",
        "ms-azuretools.vscode-docker",
        "docker.docker",
        "PKief.material-icon-theme",
        "cschlosser.doxdocgen",
        "mhutchie.git-graph",
        "cweijan.vscode-redis-client",
        "llvm-vs-code-extensions.vscode-clangd",
        "dtoplak.vscode-glsllint",
        "yzhang.markdown-all-in-one"
      ],
      "settings": {
        // Prefer clangd ALWAYS
        "C_Cpp.intelliSenseEngine": "disabled",
        "clangd.path": "/usr/bin/clangd",
        "clangd.arguments": [
          "--background-index",
          "--clang-tidy",
          "--completion-style=detailed",
          "--header-insertion=never"
        ]
      },
      // --- CMake Auto Kit Selection ---
      "cmake.generator": "Ninja",
      "cmake.preferredGenerators": [
        "Ninja"
      ],
      "cmake.cmakePath": "/usr/bin/cmake",
      "cmake.configureSettings": {
        "CMAKE_C_COMPILER": "/usr/bin/clang",
        "CMAKE_CXX_COMPILER": "/usr/bin/clang++"
      },
      "cmake.autoSelectKit": true,
      "cmake.scanForKitsOnOpen": true,
      "cmake.ignoreKitEnvironmentChanges": true
    }
  }
}